# Руководство по защите сборок с помощью .NET Reactor

## .NET Reactor

.NET Reactor предоставляет широкий набор средств защиты, включая шифрование строк, обфускацию, контроль целостности и защиту от отладки.  


## Назначение и структура

Система защиты предназначена для предотвращения:

- несанкционированного доступа к исходному коду;
- анализа логики выполнения программ;
- модификации или подмены бинарных файлов.

Применение .NET Reactor осуществляется после компиляции проекта, на этапе пост-сборки.  
В результате создаются защищённые версии исполняемых файлов, размещаемые в директории Secure.
Их следует использовать вместо оригинальных в итоговых сборках для распространения


## Общие принципы работы

После установки и запуска .NET Reactor открывается основное окно конфигурации проекта.  
Рабочий процесс состоит из нескольких этапов:

1. **Выбор сборок для защиты.**  
   Укажите все `.dll` файлы, которые необходимо защитить, исключая внешние библиотеки и сторонние зависимости.
2. **Настройка параметров защиты.**  
   Активируйте подходящие функции в разделе `Quick Settings`.
  Оптимальные параметры могут различаться в зависимости от назначения сборки.
  Например, для модулей, где важна высокая производительность (таких как графический рендер), следует применять более щадящие методы защиты.
  Подробное описание всех доступных настроек приведено ниже.
3. **Запуск защиты.**  
   Нажмите **Protect**, после чего обработанные файлы появятся в папке `Secure`.
4. **Проверка результата.**  
   Убедитесь, что исходные сборки работают корректно, а обфускация не нарушила логику выполнения.


## Основные функции защиты

### Anti ILDASM
Блокирует возможность декомпиляции сборки средствами Microsoft IL Disassembler (ILDASM) и аналогичными инструментами.  
При активации этой функции декомпилятор не сможет открыть сборку и выдаст ошибку доступа.

**Рекомендация:** включать во всех релизных сборках. Функция не влияет на производительность.


### Anti Tampering
Проверяет целостность исполняемого файла во время выполнения.  
Если обнаружены изменения, программа может автоматически завершить работу, предотвращая подмену кода.

**Рекомендация:** включать всегда.  
Полезна при защите от несанкционированных патчей или внедрения вредоносных модификаций.


### String Encryption
Шифрует все строковые литералы в коде (сообщения, пути, параметры и т.д.), делая невозможным просмотр текста в статическом виде.  
При запуске строки расшифровываются динамически.

**Преимущества:**
- затрудняет поиск ключевых строк и паролей;
- снижает риск анализа уязвимых мест кода.

**Рекомендация:** активировать в стандартном режиме.  
Агрессивное шифрование может незначительно повысить время запуска.


### Anti Debug
Обнаруживает отладчики во время выполнения и завершает процесс при попытке анализа.  
Используется для предотвращения реверс-инжиниринга через IDE или отладочные инструменты.

**Рекомендация:** включать выборочно.  
В отдельных средах возможны ложные срабатывания, поэтому перед использованием рекомендуется провести индивидуальное тестирование каждой сборки.


### Control Flow Obfuscation
Модифицирует поток управления внутри методов, превращая исходную логику в «спагетти-код».  
Такая обфускация значительно затрудняет понимание структуры программы даже при успешной декомпиляции.

**Особенности:**
- повышает устойчивость к анализу;  
- усложняет деобфускацию;  
- может снижать производительность при высоких уровнях.

**Рекомендация:** Рекомендуется применять для критичных модулей, где риск реверс-инжиниринга наиболее высок.
Подробные результаты тестов влияния на производительность приведены ниже.


## Настройка обфускации

Обфускация является основным механизмом запутывания логики кода.

Рекомендуется использовать щадящие настройки обфускация (далее Sparing Obfuscation или SO)

Щадящая обфускация — это режим защиты, при котором сохраняется корректная работа сборок и совместимость с другими компонентами, но при этом код становится труднее для анализа.
В этом режиме применяются умеренные методы переименования и запутывания, исключая ключевые элементы, необходимые для работы движка.

Рекомендуемые параметры (раздел Settings → Obfuscation → Exclusions):

| Элемент | Статус | Назначение |
|----------|---------|------------|
| **Application Resources** | Исключено | Нужно, чтобы приложение находило встроенные ресурсы — изображения, строки и файлы |
| **Application Settings** | Исключено | Сохраняет имена параметров конфигурации, чтобы настройки корректно загружались |
| **Fields** | Включено | Обфусцируются для усложнения анализа |
| **Method Parameters** | Исключено | Оставляем без изменений, чтобы параметры методов оставались читаемыми и вызывались без ошибок |
| **Properties** | Исключено | Исключаем, чтобы корректно работали механизмы доступа к данным и настройки через свойства |
| **Types** | Исключено | Сохраняем имена типов для совместимости между сборками и правильной работы внешних ссылок |
| **Serializable Types** | Исключено | Нужно, чтобы объекты правильно сохранялись и восстанавливались при сериализации |
| **Enums / Enum Fields** | Исключено | Сохраняем имена элементов перечислений, чтобы не возникало ошибок при их использовании |
| **Namespaces** | Исключено | Сохраняет оригинальные пространства имён, чтобы структура кода оставалась стабильной |
| **Methods** | Включено | Обфусцируются для защиты бизнес-логики и предотвращения анализа программы |



### Основные принципы:

- не обфусцировать внешние библиотеки и фреймворки;
- исключить из защиты сборки, содержащие только API-интерфейсы;
- протестировать результат после каждой итерации изменений.


## Рекомендации по применению

- Применяйте защиту только к финальным сборкам, прошедшим тестирование.  
- Не выполняйте повторную обфускацию уже защищённых файлов.  
- Перед релизом проверяйте сборки с помощью декомпилятора **JetBrains dotPeek** — для оценки эффективности защиты.  
- Избегайте чрезмерных уровней Control Flow — они значительно увеличивают размер и время выполнения сборки.  
- Храните исходные (необфусцированные) версии отдельно и в безопасном хранилище.

---

## Производительность и тестирование

Ниже приведены результаты внутренних тестов, демонстрирующие влияние различных уровней `Control Flow Obfuscation` на время выполнения программы.  
Измерения проводились в миллисекундах (ms).  
Показатель **Corrupted** отражает количество сбоев или ошибок при запуске сборки.

| Конфигурация | Test 1 | Test 2 | Test 3 | Test 4 | Test 5 | Среднее (ms) | Corrupted |
|---------------|--------|--------|--------|--------|--------|----------------|------------|
| Без обфускации | 423,45 | 422,97 | 423,26 | 427,36 | 423,79 | **424,17** | 0 |
| Щадящая (SO) | 428,73 | 426,80 | 426,96 | 438,80 | 438,80 | **432,02** | 0 |
| 1 уровень + SO | 853,85 | 853,50 | 1280,84 | 860,04 | 1280,85 | **1025,82** | 0 |
| 2 уровень + SO | 1279,13 | 1278,90 | 1279,07 | 877,37 | 2137,92 | **1370,48** | 0 |
| 3 уровень + SO | 1280,85 | 2550,17 | 1859,51 | 855,88 | 1709,19 | **1651,12** | 0 |
| 4 уровень + SO | 1714,82 | 2144,52 | 2148,10 | 2150,46 | 1279,63 | **1887,51** | 0 |
| 5 уровень + SO | 2159,34 | 2143,50 | 1719,19 | 5553,55 | 1278,41 | **2570,79** | 0 |
| 6 уровень + SO | 4266,29 | 2567,60 | 4276,30 | 1710,77 | 2141,32 | **2992,46** | 0 |
| 7 уровень + SO | 3442,85 | 2151,52 | 2148,51 | 5563,35 | 1712,15 | **3003,68** | 2 |
| 8 уровень + SO | 4277,24 | 2137,71 | 2577,74 | 2836,38 | 4092,55 | **3184,32** | 0 |
| 9 уровень + SO | 5154,73 | 2578,19 | 2153,95 | 4503,51 | 3513,65 | **3580,81** | 0 |

### Результаты

- Щадящая обфускация оказывает минимальное влияние на производительность.  
- С ростом уровня Control Flow наблюдается увеличение времени выполнения в 5–8 раз.  
- При уровнях выше 6 возможны редкие сбои или нестабильность.  
- Оптимальным признан диапазон **1–3 уровня** в сочетании с базовой обфускацией (SO).

При соблюдении данных рекомендаций достигается оптимальный баланс между безопасностью, скоростью и устойчивостью приложения.
